#HAPPY PATH + UNHAPPY PATH: retrieveDataServiceList
openapi: 3.0.0
info:
  title: lista dal Data Service l’identificativo della Tipologia di Prova e le informazioni descrittive 
  description: Recupera dal Data Service Directory l’identificativo e le informazioni descrittive dell’Ente Erogatore
  version: 1.0.7
servers:
  - url: http://<url_service_catalog>
    description: Local server
  - url: http://<url_service_catalog>
    description: Development server
  - url: http://<url_service_catalog>
    description: Test server
  - url: http://<url_service_catalog>
    description: Certification server
  - url: http://<url_service_catalog>
    description: Production server
paths:
  /api/v1/data-service/list/:
    get:
      security:
        - Authorization: []         
      tags:
        - retrieveDataServiceList 
      summary: restituisce l’identificativo e le informazioni descrittive dell’Ente Erogatore  
      description: il metodo get restituisce l’identificativo e le informazioni descrittive dell’Ente Erogatore
      parameters:
        - in: query
          name: queryId
          required: true
          schema:
            type: string
          description: Questo parametro deve essere valorizzato con la seguente stringa "urn:oots:dsd:ebxmlregrep:queries:dataservices-by-evidencetypeand-jurisdiction" 
        - in: query
          name: evidenceType
          required: true
          schema:
            type: string
          description: Identificativo del tipo di prova
        - in: query
          name: countryCode
          required: true
          schema:
            type: string
          description: 2 lettere ISO 3166-1 alpha-2 del prefisso internazionale.       
        - in: query
          name: adminUnitL2
          required: false
          schema:
            type: string
          description: 2 Codice NUTS da 3 a 6 lettere.         
        - in: query
          name: adminUnitL3
          required: false
          schema:
            type: string
          description: Codice LAU
        - in: query
          name: userIdentificationOrigin
          required: true
          schema:
            type: string
          description: Locazione utente dello schema eID usato per l’autenticazione.DEVE essere un codice paese di due lettere di ISO 3166-1 alpha-2.         
      responses:
        '200':    # status code
          description: Successful operation
          content:
            application/xml:
              schema:
                  $ref: '#/components/schemas/QueryResponse'
              example:
                xmlns: urn:oasis:names:tc:ebxml-regrep:xsd:lcm:4.0
                xmlns:lcm: urn:oasis:names:tc:ebxml-regrep:xsd:lcm:4.0
                xmlns:rim: urn:oasis:names:tc:ebxml-regrep:xsd:rim:4.0
                xmlns:rs: urn:oasis:names:tc:ebxml-regrep:xsd:rs:4.0
                xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
                xsi:schemaLocation: urn:oasis:names:tc:ebxml-regrep:xsd:lcm:4.0
                status: urn:oasis:names:tc:ebxmlregrep:ResponseStatusType:Success
                RegistryObjectList:
                  RegistryObject:
                    id: RE238912378
                    Slot:  
                      name: DataServiceEvidenceType
                      SlotValue: 
                        xsi:type: rim:AnyValueType                      
                        DataServiceEvidenceType:
                          xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
                          xmlns: http://data.europa.eu/sdg#
                          AccessService:
                            ConformsTo: oots:edm-v1.0
                            Identifier: #NON RIESCO AD INSERIRE IL VALORE --> 8889909098
                              schemeID: urn:oasis:names:tc:ebcore:partyid-type:iso6523:0060
                            Publisher:
                              Address:
                                AdminUnitLevel1: SK
                                AdminUnitLevel2: SK12
                                FullAddress: Prince Street 15
                              Identifier: #NON RIESCO AD INSERIRE IL VALORE --> 11231112313
                                schemeID: 1204
                              Jurisdiction:
                                AdminUnitLevel1: SK
                                AdminUnitLevel2: SK77
                              Name: Example Organization
                          AuthenticationLevelOfAssurance: http://eidas.europa.eu/LoA/High
                          DistributedAs:
                          - ConformsTo: https://semic.org/sa/common/birthcert-1.0.0
                            Format: http://publications.europa.eu/resource/authority/file-type/XML
                          - Format: http://publications.europa.eu/resource/authority/file-type/PDF
                          EvidenceSubjectNature: http://eidas.europa.eu/attributes/naturalperson 
                          EvidenceTypeClassification: CertificateOfBirth
                          Identifier: RE238918378
                          Title: Certificate of Birth
                          UserIdentityAttributeType: 
                          - levelOfAssurance: http://eidas.europa.eu/LoA/High
                            #NON RIESCO AD INSERIRE IL VALORE --> http://eidas.europa.eu/attributes/naturalperson/PersonIdentifier
                          - levelOfAssurance: http://eidas.europa.eu/LoA/High
                            #NON RIESCO AD INSERIRE IL VALORE --> http://eidas.europa.eu/attributes/naturalperson/CurrentFamilyName
                          - levelOfAssurance: http://eidas.europa.eu/LoA/High
                            #NON RIESCO AD INSERIRE IL VALORE --> http://eidas.europa.eu/attributes/naturalperson/CurrentGivenName
                          - levelOfAssurance: http://eidas.europa.eu/LoA/High
                            mandatory: false
                            userIdentificationOrigin: NL
                            #NON RIESCO AD INSERIRE IL VALORE --> https://sr.ec.europa.eu/identifiers/NL/person/last-4-digits-bsn
                          - levelOfAssurance: http://eidas.europa.eu/LoA/High
                            userIdentificationOrigin: IT
                            #NON RIESCO AD INSERIRE IL VALORE --> https://sr.ec.europa.eu/identifiers/IT/person/codice-fiscale
                
        '400':    # status code
          description: Failure operation
          content:
            application/xml:
              schema:
                  $ref: '#/components/schemas/QueryResponse'
              example:
                xmlns: urn:oasis:names:tc:ebxml-regrep:xsd:lcm:4.0
                xmlns:lcm: urn:oasis:names:tc:ebxml-regrep:xsd:lcm:4.0
                xmlns:rim: urn:oasis:names:tc:ebxml-regrep:xsd:rim:4.0
                xmlns:rs: urn:oasis:names:tc:ebxml-regrep:xsd:rs:4.0
                xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
                xsi:schemaLocation: urn:oasis:names:tc:ebxml-regrep:xsd:lcm:4.0
                status: urn:oasis:nammes:tc:ebxml-regrep:ResponseStatusType:Failure 
                Exception:
                  xsi:type: rs:ObjectNotFoundExceptionType
                  severity: urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error
                  message: No Evidence Providers were found based on the given parameters
                  Slot:  
                  - name: JurisdictionDetermination
                    SlotValue: 
                      xsi:type: rim:AnyValueType
                      sdg:EvidenceProviderJurisdictionDetermination:
                        sdg:JurisdictionContextId: CompanyHq
                        sdg:JurisdictionContext: Company Headquarters location
                        sdg:JurisdictionLevel: https://sr.ec.europa.eu/codelist/locationLevel/NUTS2 
                  - name: UserRequestedClassificationConcepts
                    SlotValue: 
                      xsi:type: rim:AnyValueType
                      sdg:EvidenceProviderClassification:
                        sdg:ClassificationConcept:
                          sdg:Identifier: TypeOfInsurance
                          sdg:Type: Codelist
                          sdg:ValueExpression: "http://sr.europa.eu/codelists/insuranceType"
                          sdg:Description: Type of insurance
                            #lang: en

components:
  schemas:  
  
  
    QueryResponse:
      type: object
      xml:
        prefix: 'query'
        namespace: urn:oasis:names:tc:ebxml-regrep:xsd:query:4.0
      properties:
        xmlns:
          type: string
          default: urn:oasis:names:tc:ebxml-regrep:xsd:lcm:4.0
          xml:
            attribute: true
        xmlns:lcm:
          type: string
          default: urn:oasis:names:tc:ebxml-regrep:xsd:lcm:4.0
          xml:
            attribute: true
        xmlns:rim:
          type: string
          default: urn:oasis:names:tc:ebxml-regrep:xsd:rim:4.0
          xml:
            attribute: true
        xmlns:rs:
          type: string
          default: urn:oasis:names:tc:ebxml-regrep:xsd:rs:4.0
          xml:
            attribute: true    
        xmlns:xsi:
          type: string
          default: http://www.w3.org/2001/XMLSchema-instance
          xml:
            attribute: true      
        xsi:schemaLocation:
          type: string
          default: urn:oasis:names:tc:ebxml-regrep:xsd:lcm:4.0
          xml:
            attribute: true  
        xmlns:xlink: 
          type: string
          default: http://www.w3.org/1999/xlink    
          xml:
            attribute: true
        requestId:
          type: string
          example: c4369c4d-740e-4b64-80f0-7b209a66d629
          xml:
            attribute: true   
        status:
          type: string
          default: urn:oasis:names:tc:ebxmlregrep:ResponseStatusType:Success
          xml:
            attribute: true     
            
        Exception:
          required:
           - xsi:type
           - severity
           - message
          type: object
          xml: 
            prefix: 'rs'
          properties:
            xsi:type:
              type: string
              default: rs:ObjectNotFoundExceptionType

              xml:
                attribute: true
            severity:
              type: string
              default: urn:oasis:names:tc:ebxml-regrep:ErrorSeverityType:Error
              xml:
                attribute: true            
            message:
              type: string
              default: The requirement requested, represented by the requirement id, does not exist
              xml:
                attribute: true                 
            detail:
              type: string
              description: Deve contenere informazioni dettagliate sull'errore, ad esempio informazioni tecniche o una traccia dello stack.
              xml:
                attribute: true
            code:
              type: string
              default: EB:ERR:0002
              xml:
                attribute: true  
            Slot:
              type: array
              items:
                $ref: '#/components/schemas/Slot'
              xml:
                wrapped: false
            
            
            
            
        RegistryObjectList:
          type: object
          xml:
            prefix: 'rim'
          properties:
            RegistryObject:
              type: object
              xml:
                prefix: 'rim'
              required:
                - id
              properties:
                id:
                  type: string
                  xml:
                    attribute: true    
                    
                    
                Slot:
                  type: object
                  xml:
                    prefix: 'rim'
                  required:
                    - name
                  properties:
                    name:
                      type: string
                      example: DataServiceEvidenceType
                      xml:
                        attribute: true
                    SlotValue:
                      type: object
                      xml:
                        prefix: 'rim'
                      required:
                        - xsi:type
                      properties:
                        xsi:type:
                          type: string
                          default: rim:AnyValueType
                          xml:
                            attribute: true     
                            

                        DataServiceEvidenceType:
                          required:
                            - Identifier
                            - DistributedAs
                            - AccessService
                            - AuthenticationLevelOfAssurance
                            - UserIdentityAttributeType
                          type: object
                          properties:
                            xmlns:
                              type: string
                              default: http://data.europa.eu/sdg#
                              xml:
                                attribute: true
                            xmlns:xsi:
                              type: string
                              default: http://www.w3.org/2001/XMLSchema-instance
                              xml:
                                attribute: true
                            Identifier:
                              type: string
                              description: Tipologia di Prova (Evidence Type) Metadata. Identificatore   univoco fornito dal Data Service per                 identificare in modo   univoco il tipo di prova ed i metadati correlati.
                            EvidenceTypeClassification:
                              type: string
                              description: Informazioni sulla classificazione.  Usato per il collegamento   con l’Evidence Broker
                            Title:
                              type: string
                              description: Titolo relativo alle informazioni sulla classificazione   
                            DistributedAs:
                                $ref: '#/components/schemas/DistributedAsArray'

                            
                                  
                            AccessService:
                              type: object
                              description: Servizio di accesso rappresenta il Servizio dati che notifica   la prova per conto di un Fornitore di                 prove. E’ consentito   avere Servizi ad accesso multiplo (Multiple Access Services) al quale è   associato un singolo                 Fornitore di prove (Evidence Provider  ).
                              required:  
                                - AccessURL
                                - ConformsTo
                                - Publisher
                              properties:  
                                Identifier:
                                  required:        
                                    - schemeID
                                  description: Identificatore del servizio di accesso. E’utilizzato   dall'infrastruttura eDelivery per estrarre e                   utilizzare il PMode preconfigurato appropriato per l'invio della   richiesta di prove
                                  type: object
                                  properties:
                                    schemeID:
                                      type: string
                                      example: urn:oasis:names:tc:ebcore:partyid-type:iso6523:0060
                                      xml:
                                        attribute: true
                                    
                                AccessURL:
                                  type: string
                                  description: URL del servizio d’accesso.
                                ConformsTo:
                                  type: string
                                  description: Versione e Profilo     dell’Evidence Exchange Message Data       Model.
                                  default: "oots:edm-1.0"
                                Publisher:
                                  type: object
                                  description: Informazioni sull’accesso del Fornitore di Prove (Evidence   Provider) fornisce il nome, l'ubicazione                 e la   giurisdizione del fornitore di prove, utilizzato dal richiedente di   prove (Evidence Requester) per                 filtrare e selezionare   il fornitore di prove corretto.
                                  required: 
                                    - Jurisdiction
                                  properties:
                                    Identifier:
                                      required:        
                                        - schemeID
                                      description: Identificatore del servizio di accesso. E’utilizzato   dall'infrastruttura     eDelivery per                 estrarre e   utilizzare il PMode preconfigurato appropriato per l'invio       della richiesta di prove
                                      type: object
                                      properties:
                                        schemeID:
                                          type: string
                                          example: 1204
                                          xml:
                                            attribute: true      
                                    Name:
                                      type: string
                                      description: Etichetta associata all’agente.
                                    Address:
                                      type: object
                                      description: Una posizione del fornitore di prove sotto forma di   indirizzo. Se la giurisdizione basata sul                   territorio fisico non può essere fornita, l'indirizzo può essere   fornito per facilitare il requisito                 funzionale per   determinare il fornitore di prove in base alle informazioni sulla   posizione
                                      properties: 
                                        FullAddress: 
                                          type: string
                                          description: Indirizzo completo del Fornitore delle Tipologie di   Prova (Evidence Provider). 
                                        AdminUnitLevel1:
                                          $ref: '#/components/schemas/AdminUnitLevel1'
                                        AdminUnitLevel2:
                                           $ref: '#/components/schemas/AdminUnitLevel2'
                                        AdminUnitLevel3:
                                           $ref: '#/components/schemas/AdminUnitLevel3'
                                    Jurisdiction:
                                      type: object
                                      description: La giurisdizione spaziale del fornitore di prove. Il   codice dovrebbe riflettere la demarcazione                   geografica più precisa per la giurisdizione applicabile   nell'elenco dei codici utilizzati. Ad esempio,                   codice LAU o NUTS per Vienna.
                                      properties: 
                                        AdminUnitLevel1:
                                          $ref: '#/components/schemas/AdminUnitLevel1'
                                        AdminUnitLevel2:
                                           $ref: '#/components/schemas/AdminUnitLevel2'
                                        AdminUnitLevel3:
                                           $ref: '#/components/schemas/AdminUnitLevel3'
                            
                            AuthenticationLevelOfAssurance:
                              type: string
                              example: http://eidas.europa.eu/LoA/High
                              description: Livello di garanzia richiesto dell'autenticazione       dell'utente.
                            EvidenceSubjectLevelOfAssurance:
                              type: string
                              description: Il livello minimo di proprietà del livello di garanzia deve avere per essere preso in considerazione per l’account del record del soggetto da parte di questo set di dati. Corrisponde alle capacità eIDAS.
                            EvidenceSubjectIdentifierScheme:
                              type: string
                              description: L'indicazione degli schemi di identificazione è supportata dalla corrispondenza del record del soggetto.
                            EvidenceProviderDeterminationContext:
                              type: string
                              description: Le informazioni necessarie per selezionare il provider di prove da utilizzare per questo tipo di prova associato 
                            UserIdentityAttributeType:
                              $ref: '#/components/schemas/UserIdentityAttributeTypeArray'
                            EvidenceSubjectNature:
                              type: string
                              example: http://eidas.europa.eu/attributes/naturalperson
                              description: Indica il tipo di persona da autenticare. Sono consentite 2 tipologie attualmente. Una persona fisica, utilizzando l'URI predefinito eIDAS http://eidas.europa.eu/attributes/naturalperson Una persona giuridica, che utilizza l'URI predefinito eIDAS http://eidas.europa.eu/attributes/legalperson
   
   
    UserIdentityAttributeTypeArray:
      type: array
      items:
        $ref: '#/components/schemas/UserIdentityAttributeType'
      xml:
        wrapped: false 

    UserIdentityAttributeType:
      type: object
      required:
        - levelOfAssurance
      properties:
        levelOfAssurance:
          type: string
          example: http://eidas.europa.eu/LoA/High
          xml:
            attribute: true   
        mandatory:
          type: string
          example: false
          xml:
            attribute: true   
        userIdentificationOrigin:
          type: string
          example: NL
          xml:
            attribute: true




    DistributedAsArray:
      type: array
      items:
        $ref: '#/components/schemas/DistributedAs'
      xml:
        wrapped: false   


            
    DistributedAs:
     type: object
     description: Lista delle multiple distribuzioni disponibili per Tipologia di   Prova del Servizio Dati
     required:
       - Format
     properties:
       Format:    
         type: string
         description: formati disponibili per il tipo di prova in formato   strutturato come XML, JSON o non strutturato                 come PDF.
       ConformsTo:
         type: string
         description: Solo per formati strutturati come XML, JSON, RDF il   servizioornire una dichiarazione di                   conformità per indicare ii conformità semantica e tecnica.   L’URL che punta a una voce derepository semantico   OOTS che contiene tutte le informazioni rilevantrofilo.
                                 
            
    AdminUnitLevel1:
      type: string
      description: Unità di amministrazione relativi all'esercizio dei diritti   giurisdizionali. Il livello 1 si riferisce all'unità amministrativa più alta   per l'indirizzo, quasi sempre un paese.
    AdminUnitLevel2:
      type: string
      description: Unità di amministrazione relativi all'esercizio dei diritti giurisdizionali. Il livello 2 si riferisce alla regione dell'indirizzo, di solito una contea, uno stato o un'altra area simile che in genere  comprende diverse località.
    AdminUnitLevel3:
      type: string
      description: Unità di amministrazione relativi all'esercizio dei diritti giurisdizionali. Il livello 3 si riferisce al comune.




    Slot:
      type: object
      xml:
        prefix: 'rim'
      required:
        - SlotValue
      properties:
        name:
          type: string
          example: JurisdictionDetermination 
          enum:
           - JurisdictionDetermination
           - UserRequestedClassificationConcepts
          xml:
            attribute: true
        SlotValue:
          type: object
          xml:
            prefix: 'rim'
          required:
            - xsi:type
          properties:
            xsi:type:
              type: string
              example: rim:AnyValueType
              xml:
                attribute: true      
            sdg:EvidenceProviderJurisdictionDetermination:
              type: object
              properties:
                sdg:JurisdictionContextId:
                  type: string
                  description: response della Data Service Directory all’utente
                sdg:JurisdictionContext:
                  type: string
                  description: Il contesto della giurisdizione stessa. Nella lingu visualizzare nell’interfaccia utente del richiedente di prove
                sdg:JurisdictionLevel:
                  type: string
                  description: Il livello di giurisdizione richiesto, definend granularita' richiesta della giurisdizione

            sdg:EvidenceProviderClassification:
              type: object
              properties:
                sdg:ClassificationConcept:
                  type: object
                  properties:
                    sdg:Identifier:
                      type: string
                      example: TypeOfInsurance 
                      description: Identificatore del filtro
                    sdg:Type:
                      type: string
                      example: String
                      description: Tipo di dato
                    sdg:ValueExpression:
                      type: string
                      example: ^\d{5}$
                      #description: Sintassi filtro attraverso Espressione Regolare  
                    Description:
                      type: object
                      description: Descrizione del filtro. esempio, Type of insurance
                      properties:
                        lang:
                          type: string
                          example: en
                          xml:
                            attribute: true 
                          description: Specifica il linguaggio          
  
 
 
  securitySchemes:
    Authorization:            # Bearer <Voucher PDND>
      type: http
      scheme: bearer
      bearerFormat: JWT       
    